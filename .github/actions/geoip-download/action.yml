name: GeoIP Download

description: Downloads GeoIP City & Country Databases for Integration Tests

inputs:
  maxmind_license_key:
    type: string
    required: true

runs:
  using: composite
  steps:
    - uses: actions/checkout@v3

    - name: restore cache
      uses: actions/cache@v3
      id: geoip-cache
      with:
        path: geoip/download
        key: v1::geoip

    - name: Download Databases
      if: ${{ steps.geoip-cache.cache-hit != 'true' }}
      shell: bash
      run: ./scripts/download-geoip-databases.sh
      env:
        MAXMIND_LICENSE_KEY: ${{ inputs.maxmind_license_key }}
        DOWNLOAD_ONLY: "1"

    - name: Unpack Databases
      shell: bash
      run: ./scripts/download-geoip-databases.sh
      env:
        DOWNLOAD_ONLY: "0"

