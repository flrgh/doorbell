lua_shared_dict doorbell   5m;
lua_shared_dict rules      5m;
lua_shared_dict metrics    5m;
lua_shared_dict stats      5m;
lua_shared_dict rules_hash 5m;
lua_shared_dict locks      5m;

lua_shared_dict mock 5m;

server {
    # spec.testing.constants.MOCK_UPSTREAM_PORT
    listen 8765;

    location / {
        content_by_lua_block {
            require("spec.testing.mock-upstream").serve()
        }

        log_by_lua_block {
            require("spec.testing.mock-upstream").log()
        }
    }

    location /_/prepare {
        content_by_lua_block {
            require("spec.testing.mock-upstream").prepare()
        }
    }

    location /_/last {
        content_by_lua_block {
            require("spec.testing.mock-upstream").get_last()
        }
    }


    location /_/reset {
        content_by_lua_block {
            require("spec.testing.mock-upstream").reset()
        }
    }
}

# vim: set ft=nginx ts=4 sw=4 sts=4 et :
